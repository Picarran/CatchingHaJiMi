<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <title>游戏 - 点格子困猫</title>
    <link rel="stylesheet" th:href="@{/css/style.css(v=${#dates.createNow().time})}" />
</head>

<body>
    <div class="container game-container">
        <div class="row" style="margin-bottom:10px; justify-content:flex-start;">
            <button id="back-home" class="btn btn-outline">返回主页</button>
        </div>
        <div class="game-layout">
            <div class="board-wrap">
                <div id="game-area"></div>
            </div>
            <aside class="side-panel">
                <h2>逮捕哈基米</h2>
                <p class="muted">玩法：点击空格放置障碍，阻止哈基米到达地图边界逃跑。注意：哈基米只能沿“上/下/左/右”四个方向移动。</p>
                <p class="muted">提示：尽量封住最短路径，优先包围中心附近的空位。</p>
                <p class="muted" th:if="${bestClicks} != null" th:text="|本地图最佳：${bestClicks} 步|"></p>
                <p class="muted" th:if="${bestClicks} == null">本地图最佳：未成功</p>
            </aside>
        </div>

        <div id="modal" class="modal" style="display:none;">
            <div class="modal-content">
                <p id="modal-text"></p>
                <div class="row">
                    <button id="to-dashboard" class="btn btn-outline">返回 Dashboard</button>
                    <button id="restart" class="btn btn-primary">再玩一次</button>
                </div>
            </div>
        </div>

        <!-- 返回主页确认弹窗 -->
        <div id="confirm-exit" class="modal" style="display:none;">
            <div class="modal-content">
                <p>确定要返回主页吗？当前对局将结束，未完成成绩不会保存。</p>
                <div class="row">
                    <button id="confirm-exit-cancel" class="btn btn-outline" data-modal-close="true">取消</button>
                    <button id="confirm-exit-ok" class="btn btn-danger">确认返回</button>
                </div>
            </div>
        </div>

        <script th:inline="javascript">
            /*<![CDATA[*/
            var INITIAL_MAP = /*[[${mapJson}]]*/ 'null';
            var GAME_UUID = /*[[${gameUuid}]]*/ 'null';
            /*]]>*/
        </script>
        <script th:src="@{/js/modal.js(v=${#dates.createNow().time})}"></script>
        <script th:src="@{/js/game.js(v=${#dates.createNow().time})}"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                var backBtn = document.getElementById('back-home');
                var confirmModal = document.getElementById('confirm-exit');
                var okBtn = document.getElementById('confirm-exit-ok');
                if (backBtn && confirmModal) {
                    backBtn.addEventListener('click', function () {
                        confirmModal.style.display = 'flex';
                    });
                }
                if (okBtn) {
                    okBtn.addEventListener('click', function () {
                        window.location.href = '/dashboard';
                    });
                }
            });
        </script>
    </div>
</body>

</html>